---
id: 120
title: 'Run-Length Encoding (RLE) in C#'
date: 2012-08-17T14:47:10-04:00
author: brad
layout: post
guid: http://avian.netne.net/blog/?p=120
permalink: /run-length-encoding-rle-in-c/
categories:
  - Programming
tags:
  - algorithms
  - 'C#'
  - Programming
---
I recently came across a file format that required usage of [Run Length Encoding](http://en.wikipedia.org/wiki/Run-length_encoding) to handle. This involved writing methods for both decoding and encoding. Here are my results:

<!--more-->

To decode, you just use a string and concatenate it with each numeric character that is encountered until you hit a non-numeric character. You use this string to figure out how many times you need to repeat the character:

<div class="codecolorer-container csharp default" style="overflow:auto;white-space:nowrap;height:300px;">
  <div class="csharp codecolorer">
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">string</span> Decode<span class="br0">&#40;</span><span class="kw4">string</span> toDecode<span class="br0">&#41;</span><br /> <span class="br0">&#123;</span><br /> &nbsp; &nbsp; <span class="kw4">string</span> coefficient <span class="sy0">=</span> <span class="kw4">String</span><span class="sy0">.</span><span class="me1">Empty</span><span class="sy0">;</span><br /> &nbsp; &nbsp; StringBuilder sb <span class="sy0">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span class="kw3">new</span></a> StringBuilder<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> <br /> &nbsp; &nbsp; <span class="kw1">foreach</span> <span class="br0">&#40;</span><span class="kw4">char</span> current <span class="kw1">in</span> toDecode<span class="br0">&#41;</span><br /> &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw4">char</span><span class="sy0">.</span><span class="me1">IsDigit</span><span class="br0">&#40;</span>current<span class="br0">&#41;</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; coefficient <span class="sy0">+=</span> current<span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>coefficient <span class="sy0">==</span> <span class="kw4">String</span><span class="sy0">.</span><span class="me1">Empty</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sb<span class="sy0">.</span><span class="me1">Append</span><span class="br0">&#40;</span>current<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">int</span> count <span class="sy0">=</span> <span class="kw4">int</span><span class="sy0">.</span><span class="me1">Parse</span><span class="br0">&#40;</span>coefficient<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; coefficient <span class="sy0">=</span> <span class="kw4">String</span><span class="sy0">.</span><span class="me1">Empty</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> j <span class="sy0">=</span> <span class="nu0"></span><span class="sy0">;</span> j <span class="sy0"><</span> count<span class="sy0">;</span> j<span class="sy0">++</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sb<span class="sy0">.</span><span class="me1">Append</span><span class="br0">&#40;</span>current<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; <span class="kw1">return</span> sb<span class="sy0">.</span><span class="me1">ToString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> <span class="br0">&#125;</span>
  </div>
</div>

Similarly, for encoding. I used a stringbuilder and a counter to figure out how many times a character was repeated then appended this to the stringbuilder:

<div class="codecolorer-container csharp default" style="overflow:auto;white-space:nowrap;">
  <div class="csharp codecolorer">
    <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">string</span> Encode<span class="br0">&#40;</span><span class="kw4">string</span> toEncode<span class="br0">&#41;</span><br /> <span class="br0">&#123;</span><br /> &nbsp; &nbsp; StringBuilder sb <span class="sy0">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span class="kw3">new</span></a> StringBuilder<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <br /> &nbsp; &nbsp; <span class="kw4">int</span> count <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span> <br /> &nbsp; &nbsp; <span class="kw4">char</span> current <span class="sy0">=</span> toEncode<span class="br0">&#91;</span><span class="nu0"></span><span class="br0">&#93;</span><span class="sy0">;</span> <br /> &nbsp; &nbsp; <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span> i <span class="sy0"><</span> toEncode<span class="sy0">.</span><span class="me1">Length</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>current <span class="sy0">==</span> toEncode<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count<span class="sy0">++;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span> <span class="kw1">else</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sb<span class="sy0">.</span><span class="me1">AppendFormat</span><span class="br0">&#40;</span><span class="st0">"{0}{1}"</span>, count, current<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; current <span class="sy0">=</span> toEncode<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; sb<span class="sy0">.</span><span class="me1">AppendFormat</span><span class="br0">&#40;</span><span class="st0">"{0}{1}"</span>, count, current<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="kw1">return</span> sb<span class="sy0">.</span><span class="me1">ToString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> <span class="br0">&#125;</span>
  </div>
</div>

Note that RLE is a primitive form of compression and should probably be avoided. If you need to compress something for transmission or storage you might be better off using something like [GZipStream](http://msdn.microsoft.com/en-us/library/system.io.compression.gzipstream.aspx).