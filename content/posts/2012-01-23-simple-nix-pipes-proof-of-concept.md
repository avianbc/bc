---
id: 370
title: 'Simple *nix pipes proof of concept'
date: 2012-01-23T23:17:06-04:00
author: brad
layout: post
guid: http://br4d.net/?p=370
permalink: /simple-nix-pipes-proof-of-concept/
categories:
  - C / C++
  - Linux
  - Programming
---
This program is a simple program that uses pipes to relay information. In this case, the information is a string which the case is inverted and then displayed. This program was written on [Minix](http://www.minix3.org/) using the elvis text editor and compiled in gcc.

<!--more-->

<div class="codecolorer-container c default">
  <div class="c codecolorer">
    <span class="co2">#include <stdio.h></span><br /> <span class="co2">#include <unistd.h></span><br /> <span class="co2">#include <sys/types.h></span><br /> <span class="co2">#include <string.h></span><br /> <span class="co2">#include <ctype.h></span><br /> <span class="co2">#define BUFFER_SIZE 25</span><br /> <span class="co2">#define READ_END 0</span><br /> <span class="co2">#define WRITE_END 1</span><br /> &nbsp;<br /> <span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><br /> <span class="br0">&#123;</span><br /> &nbsp; &nbsp; <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">"start"</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="kw4">char</span> write_msg<span class="br0">&#91;</span>BUFFER_SIZE<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">"Greetings"</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="kw4">char</span> read_msg<span class="br0">&#91;</span>BUFFER_SIZE<span class="br0">&#93;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; pid_t pid<span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="kw4">int</span> first_pipe<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="kw4">int</span> second_pipe<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="kw4">int</span> i<span class="sy0">;</span><br /> &nbsp;<br /> &nbsp; &nbsp; <span class="kw1">if</span><span class="br0">&#40;</span>pipe<span class="br0">&#40;</span>first_pipe<span class="br0">&#41;</span> <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">"First Pipe failed"</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp;<br /> &nbsp; &nbsp; <span class="kw1">if</span><span class="br0">&#40;</span>pipe<span class="br0">&#40;</span>second_pipe<span class="br0">&#41;</span> <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span class="kw3">fprintf</span></a><span class="br0">&#40;</span>stderr<span class="sy0">,</span> <span class="st0">"Second Pipe failed"</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp;<br /> &nbsp; &nbsp; pid <span class="sy0">=</span> fork<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp;<br /> &nbsp; &nbsp; <span class="kw1">if</span><span class="br0">&#40;</span>pid <span class="sy0">></span> <span class="nu0"></span><span class="br0">&#41;</span> &nbsp; &nbsp; &nbsp;<span class="co1">// parent process</span><br /> &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; close<span class="br0">&#40;</span>first_pipe<span class="br0">&#91;</span>READ_END<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; close<span class="br0">&#40;</span>first_pipe<span class="br0">&#91;</span>WRITE_END<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; read<span class="br0">&#40;</span>second_pipe<span class="br0">&#91;</span>READ_END<span class="br0">&#93;</span><span class="sy0">,</span> read_msg<span class="sy0">,</span> BUFFER_SIZE<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">"parent read :%s<<span class="es1">\n</span>"</span><span class="sy0">,</span>read_msg<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; <span class="kw1">else</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// child process</span><br /> &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; close<span class="br0">&#40;</span>second_pipe<span class="br0">&#91;</span>READ_END<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; close<span class="br0">&#40;</span>second_pipe<span class="br0">&#91;</span>WRITE_END<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; read<span class="br0">&#40;</span>first_pipe<span class="br0">&#91;</span>READ_END<span class="br0">&#93;</span><span class="sy0">,</span> read_msg<span class="sy0">,</span> BUFFER_SIZE<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">"child read >%s<<span class="es1">\n</span>"</span><span class="sy0">,</span> read_msg<span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">for</span> <span class="br0">&#40;</span>i<span class="sy0">=</span><span class="nu0"></span><span class="sy0">;</span> i <span class="sy0"><</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3">strlen</span></a><span class="br0">&#40;</span>read_msg<span class="br0">&#41;</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#123;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><a href="http://www.opengroup.org/onlinepubs/009695399/functions/isupper.html"><span class="kw3">isupper</span></a><span class="br0">&#40;</span>read_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/tolower.html"><span class="kw3">tolower</span></a><span class="br0">&#40;</span>read_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span><a href="http://www.opengroup.org/onlinepubs/009695399/functions/islower.html"><span class="kw3">islower</span></a><span class="br0">&#40;</span>read_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/toupper.html"><span class="kw3">toupper</span></a><span class="br0">&#40;</span>read_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> read_msg<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; write<span class="br0">&#40;</span>second_pipe<span class="br0">&#91;</span>WRITE_END<span class="br0">&#93;</span><span class="sy0">,</span> write_msg<span class="sy0">,</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3">strlen</span></a><span class="br0">&#40;</span>write_msg<span class="br0">&#41;</span><span class="sy0">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp; close<span class="br0">&#40;</span>second_pipe<span class="br0">&#91;</span>WRITE_END<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; close<span class="br0">&#40;</span>second_pipe<span class="br0">&#91;</span>READ_END<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span><br /> &nbsp; &nbsp; <span class="br0">&#125;</span><br /> &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0"></span><span class="sy0">;</span><br /> <span class="br0">&#125;</span>
  </div>
</div>